<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGEND ENGINE v3.0 | SECURITY CORE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        :root { --gold: #ffcc00; --red: #ff4444; --bg: #0a0e17; --panel: #161b22; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: #c9d1d9; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        
        /* Particle Background */
        #bg-canvas { position: absolute; top: 0; left: 0; z-index: -1; }

        .auth-container { background: var(--panel); padding: 40px; border-radius: 20px; border: 1px solid #30363d; box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 400px; text-align: center; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        h1 { color: var(--gold); font-weight: 900; letter-spacing: 2px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 8px; font-family: 'Cairo'; }
        button { width: 100%; padding: 12px; background: var(--gold); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-family: 'Cairo'; }
        button:hover { filter: brightness(1.2); transform: scale(1.02); }

        .game-interface { display: none; width: 95%; max-width: 1000px; background: var(--panel); border-radius: 15px; padding: 20px; border: 1px solid var(--gold); }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-item { background: #0d1117; padding: 15px; border-radius: 10px; border-bottom: 3px solid var(--gold); text-align: center; }
        
        .story-area { background: #0d1117; padding: 25px; border-radius: 10px; margin: 20px 0; border-right: 5px solid var(--gold); font-size: 1.2rem; min-height: 100px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        
        .admin-glow { animation: glow 1.5s infinite alternate; color: #00ffcc !important; font-weight: 900; }
        @keyframes glow { from { text-shadow: 0 0 5px #00ffcc; } to { text-shadow: 0 0 20px #00ffcc; } }
        .hidden { display: none; }
        .error { color: var(--red); font-size: 0.8rem; margin-top: 5px; }
    </style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<div id="auth-box" class="auth-container">
    <h1>LEGEND OS</h1>
    <p id="auth-title">Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø­Ø±Ùƒ</p>
    <input type="text" id="user-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="user-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="Auth.process()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    <p id="auth-error" class="error hidden">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</p>
    <div style="margin-top: 15px; font-size: 0.8rem;">
        <a href="#" onclick="Auth.toggleMode()" id="toggle-link" style="color: var(--gold); text-decoration: none;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
    </div>
</div>

<div id="main-game" class="game-interface">
    <div class="stats-grid">
        <div class="stat-item"><span>Ø§Ù„Ù…ØºØ§Ù…Ø±</span><br><span id="s-name" style="color: var(--gold)">-</span></div>
        <div class="stat-item"><span>Ø§Ù„Ø°Ù‡Ø¨</span><br><span id="s-gold" style="color: var(--gold)">0</span></div>
        <div class="stat-item"><span>Ø§Ù„ÙÙˆØ²</span><br><span id="s-wins" style="color: var(--gold)">0</span></div>
        <div class="stat-item"><span>Ø§Ù„Ù‚ÙˆØ©</span><br><span id="s-power" style="color: var(--gold)">100%</span></div>
    </div>

    <div class="story-area" id="log-text">ØªÙ… Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ©.. Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ.</div>

    <div class="menu-grid">
        <button onclick="Engine.mine()">â›ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø·Ø§Ù‚Ø© (+500ğŸ’°)</button>
        <button onclick="UI.showShop()">ğŸ›’ Ù…Ø®Ø²Ù† Ø§Ù„Ù€ 100 Ù‚ØµØ©</button>
        <button onclick="Auth.logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="shop-container" class="hidden" style="margin-top:20px; max-height: 300px; overflow-y: auto;">
        </div>
</div>

<script>
    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ ---
    const Auth = {
        isLoginMode: true,
        // ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø·ÙˆØ± (ØºÙŠØ±Ù‡Ø§ ÙƒÙ…Ø§ ØªØ­Ø¨)
        adminKey: "teem2026", 

        process() {
            const name = document.getElementById('user-name').value.trim();
            const pass = document.getElementById('user-pass').value.trim();
            const err = document.getElementById('auth-error');

            if(!name || !pass) {
                err.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„";
                err.classList.remove('hidden');
                return;
            }

            // ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø®Ø§Øµ
            if(name === "Ø§Ù„Ù…Ø·ÙˆØ±" && pass === this.adminKey) {
                this.launch(name, true);
                return;
            }

            const db = JSON.parse(localStorage.getItem('user_db') || '{}');

            if(this.isLoginMode) {
                if(db[name] && db[name].pass === pass) {
                    this.launch(name);
                } else {
                    err.innerText = "Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!";
                    err.classList.remove('hidden');
                }
            } else {
                if(db[name]) {
                    err.innerText = "Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
                    err.classList.remove('hidden');
                } else {
                    db[name] = { pass: pass, coins: 0, wins: 0, unlocked: [1] };
                    localStorage.setItem('user_db', JSON.stringify(db));
                    alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.");
                    this.toggleMode();
                }
            }
        },

        launch(name, isAdmin = false) {
            document.getElementById('auth-box').classList.add('hidden');
            document.getElementById('main-game').style.display = 'block';
            Engine.start(name, isAdmin);
        },

        toggleMode() {
            this.isLoginMode = !this.isLoginMode;
            document.getElementById('auth-title').innerText = this.isLoginMode ? "Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø­Ø±Ùƒ" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…";
            document.getElementById('toggle-link').innerText = this.isLoginMode ? "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†" : "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø¯Ø®ÙˆÙ„";
        },

        logout() { location.reload(); }
    };

    // --- Ù…Ø­Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠ ---
    const Engine = {
        user: {},
        isAdmin: false,

        start(name, isAdmin) {
            this.isAdmin = isAdmin;
            if(isAdmin) {
                this.user = { name: "ØªÙŠÙ… (Ø§Ù„Ù…Ø·ÙˆØ±)", coins: 99999999, wins: 10000, unlocked: Array.from({length:100},(_,i)=>i+1) };
                document.getElementById('s-name').classList.add('admin-glow');
            } else {
                const db = JSON.parse(localStorage.getItem('user_db'));
                this.user = { name: name, ...db[name] };
            }
            this.update();
        },

        mine() {
            this.user.coins += 500;
            document.getElementById('log-text').innerText = "ØªÙ… Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ Ø¨Ù€ 500 Ø¹Ù…Ù„Ø© Ø±Ù‚Ù…ÙŠØ© Ø£Ø³Ø·ÙˆØ±ÙŠØ©.";
            this.update();
            this.save();
        },

        buy(id) {
            const price = id * 1000;
            if(this.user.coins >= price) {
                this.user.coins -= price;
                this.user.unlocked.push(id);
                this.update();
                this.save();
                alert("ØªÙ… ÙØªØ­ Ø§Ù„Ù‚ØµØ© Ø±Ù‚Ù… " + id);
            }
        },

        play(id) {
            const events = ["ÙˆØ§Ø¬Ù‡Øª ØªÙ†ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯", "ØªØ³Ù„Ù„Øª Ù„Ù…Ù‚Ø±Ø§Øª Ø§Ù„Ø¹Ø¯Ùˆ", "ÙƒØ³Ø±Øª ØªØ´ÙÙŠØ± Ø§Ù„Ø®Ø²Ù†Ø©", "Ø¯Ù…Ø±Øª Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©"];
            const res = events[Math.floor(Math.random()*events.length)];
            const prize = id * 1500;
            this.user.coins += prize;
            this.user.wins += 1;
            document.getElementById('log-text').innerText = `ÙÙŠ Ø§Ù„Ù…Ù‡Ù…Ø© ${id}: ${res}. Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ£Ø© ${prize}ğŸ’° ÙˆÙÙˆØ² Ø¬Ø¯ÙŠØ¯!`;
            this.update();
            this.save();
        },

        update() {
            document.getElementById('s-name').innerText = this.user.name;
            document.getElementById('s-gold').innerText = this.user.coins.toLocaleString();
            document.getElementById('s-wins').innerText = this.user.wins;
            UI.renderShop();
        },

        save() {
            if(this.isAdmin) return;
            const db = JSON.parse(localStorage.getItem('user_db'));
            db[this.user.name] = { pass: this.user.pass, coins: this.user.coins, wins: this.user.wins, unlocked: this.user.unlocked };
            localStorage.setItem('user_db', JSON.stringify(db));
        }
    };

    const UI = {
        renderShop() {
            const cont = document.getElementById('shop-container');
            cont.innerHTML = "";
            for(let i=1; i<=100; i++) {
                const owned = Engine.user.unlocked.includes(i);
                const d = document.createElement('div');
                d.style = "display:flex; justify-content:space-between; padding:10px; background:#0d1117; margin-bottom:5px; border-radius:5px;";
                d.innerHTML = `<span>Ø§Ù„Ù…Ù‡Ù…Ø© #${i} (${i*1000}ğŸ’°)</span>
                               <button onclick="${owned ? 'Engine.play('+i+')' : 'Engine.buy('+i+')'}" style="width:100px; padding:5px; margin:0;">${owned ? 'Ù„Ø¹Ø¨' : 'Ø´Ø±Ø§Ø¡'}</button>`;
                cont.appendChild(d);
            }
        },
        showShop() {
            document.getElementById('shop-container').classList.toggle('hidden');
        }
    };

    // Particles
    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let p = [];
    for(let i=0; i<50; i++) p.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, vy:Math.random()*1+0.5});
    function draw() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = "rgba(255, 204, 0, 0.1)";
        p.forEach(i => {
            i.y += i.vy; if(i.y > canvas.height) i.y = 0;
            ctx.beginPath(); ctx.arc(i.x, i.y, 2, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>